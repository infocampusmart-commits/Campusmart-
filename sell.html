<!DOCTYPE html>
<html>
<head>
<title>CampusMart Seller Registration</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
input, select, textarea { width:100%; padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc; }
button { width:100%; padding:12px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
button:hover { background:#0056d6; }
</style>
</head>

<body>

<h2>Become a Seller on CampusMart</h2>

<form id="sellerForm">

  <input type="text" id="fullName" placeholder="Full Name" required>
  <input type="email" id="email" placeholder="Email" required>
  <input type="text" id="phone" placeholder="Phone Number" required>

  <select id="university" required>
    <option value="">Select University</option>
    <option value="Covenant University">Covenant University</option>
    <option value="Bells University">Bells University</option>
    <option value="Crawford University">Crawford University</option>
  </select>

  <input type="text" id="department" placeholder="Department">
  <input type="text" id="matric" placeholder="Matric/Student ID" required>

  <input type="text" id="businessName" placeholder="Business Name" required>

  <select id="businessCategory" required>
    <option value="">Select Business Category</option>
    <option value="Food">Food</option>
    <option value="Fashion">Fashion</option>
    <option value="Shoes / Bags">Shoes / Bags</option>
    <option value="Phone Accessories">Phone Accessories</option>
  </select>

  <textarea id="bio" placeholder="Short Business Description"></textarea>
  <textarea id="exampleProducts" placeholder="List 3 sample products"></textarea>

  <label><strong>Upload Student ID</strong></label>
  <input type="file" id="studentIdFile" accept="image/*" required>

  <label><strong>Upload Business Logo</strong></label>
  <input type="file" id="logoFile" accept="image/*">

  <label><strong>Upload Payment Receipt</strong></label>
  <input type="file" id="receiptFile" accept="image/*" required>

  <button type="button" id="payBtn">Pay With Paystack (₦2,000)</button>
  <button type="submit">Submit Application</button>

</form>

<p id="status"></p>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>

document.getElementById("payBtn").addEventListener("click", () => {
    const email = document.getElementById("email").value;
    const name = document.getElementById("fullName").value;

    if(!email || !name){
      alert("Please enter your name and email before paying.");
      return;
    }

    let handler = PaystackPop.setup({
        key: "YOUR_PUBLIC_KEY_HERE",
        email: email,
        amount: 2000 * 100,
        currency: "NGN",
        ref: "SELLER_" + Date.now(),
        callback: function(response){
            alert("Payment Successful ✔");
            sessionStorage.setItem("seller_payment_ref", response.reference);
        },
        onClose: function(){
            alert("Payment Cancelled ❌");
        }
    });

    handler.openIframe();
});

document.getElementById("sellerForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const paymentRef = sessionStorage.getItem("seller_payment_ref");
  if(!paymentRef){
    alert("⚠ Please complete payment first.");
    return;
  }

  const status = document.getElementById("status");
  status.textContent = "⏳ Submitting...";

  const convertToBase64 = file => {
    return new Promise(resolve => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsDataURL(file);
    });
  };

  const data = {
    fullName: fullName.value,
    email: email.value,
    phone: phone.value,
    university: university.value,
    department: department.value,
    matric: matric.value,
    businessName: businessName.value,
    businessCategory: businessCategory.value,
    bio: bio.value,
    exampleProducts: exampleProducts.value,
    payment_reference: paymentRef,
    studentIdFile: await convertToBase64(studentIdFile.files[0]),
    logoFile: logoFile.files.length ? await convertToBase64(logoFile.files[0]) : "",
    receiptFile: await convertToBase64(receiptFile.files[0])
  };

  const res = await fetch("YOUR_GOOGLE_SCRIPT_URL_HERE", {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  });

  const result = await res.json();

  if(result.status === "success"){
    status.style.color = "green";
    status.textContent = "✔ Submitted successfully! Wait for approval.";
    sessionStorage.removeItem("seller_payment_ref");
  } else {
    status.style.color = "red";
    status.textContent = "❌ Error: " + result.message;
  }

});

</script>
</body>
</html>
