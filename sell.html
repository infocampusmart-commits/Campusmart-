<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/x-icon" href="Blue 1.png">
<title>Become a Seller — CampusMart</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;padding:20px}
  .card{max-width:720px;margin:24px auto;padding:20px;border-radius:10px;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
  h1{font-size:22px;margin-bottom:8px}
  p.lead{color:#666;margin-bottom:18px}
  label{display:block;margin:12px 0 6px;font-weight:600}
  input[type="text"], input[type="email"], input[type="tel"], select, textarea{
    width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;box-sizing:border-box
  }
  input[type="file"]{margin-top:6px}
  .two {display:flex;gap:12px}
  .two > *{flex:1}
  button{display:inline-block;margin-top:16px;padding:12px 18px;background:#0b8a00;color:#fff;border:0;border-radius:8px;font-weight:700;cursor:pointer}
  .muted{color:#777;font-size:13px;margin-top:8px}
  .status{margin-top:12px;font-weight:600}
</style>
</head>
<body>
  <div class="card">
    <h1>Seller Registration — CampusMart</h1>
    <p class="lead">Register to sell on CampusMart (only Covenant University, Bells University, Crawford University for now). Fee: ₦1,500.</p>

    <form id="sellerForm">
      <label>Full Name *</label>
      <input type="text" id="fullName" required />

      <div class="two">
        <div>
          <label>Email *</label>
          <input type="email" id="email" required />
        </div>
        <div>
          <label>WhatsApp / Phone *</label>
          <input type="tel" id="phone" required />
        </div>
      </div>

      <label>University *</label>
      <select id="university" required>
        <option value="">Select University</option>
        <option value="Covenant University">Covenant University</option>
        <option value="Bells University">Bells University</option>
        <option value="Crawford University">Crawford University</option>
      </select>

      <label>Department / Level (optional)</label>
      <input type="text" id="department" placeholder="e.g. Electrical Engineering, 300" />

      <label>Matric Number / Student ID No. *</label>
      <input type="text" id="matric" required />

      <label>Upload Student ID (photo) *</label>
      <input type="file" id="studentIdFile" accept="image/*" required />

      <label>Business / Store Name *</label>
      <input type="text" id="businessName" required />

      <label>Business Category *</label>
      <select id="businessCategory" required>
        <option value="">Select category</option>
        <option>Food</option>
        <option>Clothing</option>
        <option>Ties / Custom Clothing</option>
        <option>Perfume / Oils</option>
        <option>Beauty / Hair</option>
        <option>Other</option>
      </select>

      <label>Short Business Bio (1-2 sentences)</label>
      <textarea id="bio" rows="3" placeholder="What do you sell? Where are you located?" ></textarea>

      <label>Example Products (comma separated)</label>
      <input type="text" id="exampleProducts" placeholder="E.g. Spaghetti, Small Pack - ₦200" />

      <label>Upload Business Logo (optional)</label>
      <input type="file" id="logoFile" accept="image/*" />

      <label>Bank Name (for payouts)</label>
      <input type="text" id="bankName" placeholder="e.g. GTBank" />

      <label>Account Name</label>
      <input type="text" id="accountName" />

      <label>Account Number</label>
      <input type="text" id="accountNumber" />

      <label><input type="checkbox" id="agreeTerms" required /> I confirm I am a student of the selected university and I accept CampusMart's seller terms. *</label>

      <div style="display:flex;gap:12px;margin-top:14px">
        <button type="button" id="paySellerFee">Pay ₦1,500 (Paystack)</button>
        <button type="submit">Submit Registration</button>
      </div>

      <div class="status" id="status"></div>
      <p class="muted">We will verify ID and payment before approving seller accounts.</p>
    </form>
  </div>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
/*
  Replace:
    - WEB_APP_URL with your Google Apps Script Web App URL
*/
const WEB_APP_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL_HERE"; // e.g. https://script.google.com/macros/s/XXXXXXXX/exec

// convert file to base64
function fileToBase64(file){
  return new Promise((resolve, reject) => {
    if(!file) return resolve("");
    const r = new FileReader();
    r.onload = () => resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}

// store payment reference
document.getElementById("paySellerFee").addEventListener("click", function(){
  const email = document.getElementById("email").value;
  const name = document.getElementById("fullName").value;
  if(!email || !name){ alert("Please enter your name and email before paying."); return; }

  const handler = PaystackPop.setup({
    key: "PAYSTACK_PUBLIC_KEY", // replace with your Paystack public key
    email: email,
    amount: 1500 * 100,
    currency: "NGN",
    ref: "CMSELLER_" + Date.now(),
    metadata: { custom_fields: [{ display_name: "Full Name", variable_name: "full_name", value: name }] },

    callback: function(response){
      // save ref to session so we include it when submitting form
      sessionStorage.setItem("campusmart_seller_pay_ref", response.reference);
      document.getElementById("status").style.color = "green";
      document.getElementById("status").innerText = "Payment successful — reference saved. Now submit the form.";
    },

    onClose: function(){
      document.getElementById("status").style.color = "orange";
      document.getElementById("status").innerText = "Payment window closed.";
    }
  });

  handler.openIframe();
});

// handle form submit
document.getElementById("sellerForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const statusEl = document.getElementById("status");
  statusEl.style.color = "black";
  statusEl.innerText = "Preparing submission...";

  // basic required fields check
  const required = ["fullName","email","phone","university","matric","businessName","businessCategory","agreeTerms"];
  for(const id of required){
    const el = document.getElementById(id);
    if(!el) continue;
    if((el.type === "checkbox" && !el.checked) || (el.value === "" && el.type !== "checkbox")){
      statusEl.style.color = "red";
      statusEl.innerText = "Please fill all required fields.";
      return;
    }
  }

  // ensure payment done
  const payRef = sessionStorage.getItem("campusmart_seller_pay_ref");
  if(!payRef){
    statusEl.style.color = "red";
    statusEl.innerText = "Please pay the ₦1,500 seller fee first.";
    return;
  }

  // convert files to base64
  const studentFile = document.getElementById("studentIdFile").files[0];
  const logoFile = document.getElementById("logoFile").files[0];
  statusEl.innerText = "Uploading files (to backend)...";

  try{
    const [studentIdBase64, logoBase64] = await Promise.all([
      fileToBase64(studentFile),
      fileToBase64(logoFile)
    ]);

    const payload = {
      fullName: document.getElementById("fullName").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value,
      university: document.getElementById("university").value,
      department: document.getElementById("department").value,
      matric: document.getElementById("matric").value,
      businessName: document.getElementById("businessName").value,
      businessCategory: document.getElementById("businessCategory").value,
      bio: document.getElementById("bio").value,
      exampleProducts: document.getElementById("exampleProducts").value,
      bankName: document.getElementById("bankName").value,
      accountName: document.getElementById("accountName").value,
      accountNumber: document.getElementById("accountNumber").value,
      studentIdFile: studentIdBase64,
      logoFile: logoBase64,
      payment_reference: payRef,
      timestamp: new Date().toISOString()
    };

    statusEl.innerText = "Sending registration...";
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const result = await res.json();
    if(result.status === "success"){
      statusEl.style.color = "green";
      statusEl.innerText = "Registration submitted. We will review and email you.";
      // optional: clear the form and payment ref
      sessionStorage.removeItem("campusmart_seller_pay_ref");
      document.getElementById("sellerForm").reset();
    } else {
      statusEl.style.color = "red";
      statusEl.innerText = "Error: " + (result.message || "Try again later");
    }
  } catch(err){
    statusEl.style.color = "red";
    statusEl.innerText = "Network or upload error: " + err.message;
  }
});
</script>
</body>
</html>
